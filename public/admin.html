<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Estilos gerais do painel */
        body { display: flex; background-color: #0d0d0d; }
        .admin-container { display: flex; width: 100%; height: 100vh; }
        .sidebar { width: 240px; background-color: #121212; padding: 20px; border-right: 1px solid #2a2a2a; flex-shrink: 0; }
        .sidebar h2 { color: #4CAF50; text-align: center; }
        .sidebar nav ul { list-style: none; padding: 0; margin-top: 30px; }
        .sidebar nav li a { display: block; color: #E0E0E0; padding: 12px 15px; text-decoration: none; border-radius: 5px; margin-bottom: 5px; transition: background-color 0.2s; }
        .sidebar nav li a:hover, .sidebar nav li a.active { background-color: #2a2a2a; }
        .main-content { flex-grow: 1; padding: 30px; overflow-y: auto; position: relative; }
        .admin-view { display: none; }
        .admin-view.active { display: block; }

        /* Estilos dos cards e tabelas */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .stat-card { background-color: #1E1E1E; padding: 25px; border-radius: 8px; border-left: 5px solid #4CAF50;}
        .stat-card h3 { margin: 0 0 10px; color: #B0B0B0; font-size: 1em; }
        .stat-card p { margin: 0; font-size: 2em; font-weight: bold; }
        .users-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .users-table th, .users-table td { padding: 12px; border: 1px solid #2a2a2a; text-align: left; }
        .users-table th { background-color: #2a2a2a; }
        .users-table tbody tr:hover { background-color: #2a2a2a; cursor: pointer; }
        .chart-card { background-color: #1E1E1E; padding: 25px; border-radius: 8px; margin-top: 30px; }
        .chart-card h2 { margin-top: 0; color: #E0E0E0; }

        /* Estilos do controle de jogo */
        #game-control-view .bet-button[data-color="RED"] { background-color: #E53935; color: white; }
        #game-control-view .bet-button[data-color="BLUE"] { background-color: #1976d2; color: white; }
        #game-control-view .bet-button[data-color="GREEN"] { background-color: #43a047; color: white; }
        #game-control-view .bet-button:hover { opacity: 0.9; transform: translateY(-1px); }
        
        /* Estilos para o Modal de Edição */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { background-color: #1E1E1E; padding: 30px; border-radius: 10px; width: 90%; max-width: 500px; box-shadow: 0 5px 25px rgba(0,0,0,0.5); position: relative; }
        .modal-content h2 { margin-top: 0; color: #00BCD4; }
        .modal-close { position: absolute; top: 15px; right: 15px; background: none; border: none; color: white; font-size: 1.5em; cursor: pointer; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #B0B0B0; }
        .form-group select, .form-group input { width: 100%; padding: 10px; background-color: #2a2a2a; border: 1px solid #333; color: white; border-radius: 5px; }
        .transaction-buttons { display: flex; gap: 10px; margin-top: 10px; }
        .transaction-buttons button { flex-grow: 1; }
        .bonus-checkbox { display: flex; align-items: center; gap: 10px; margin-top: 10px; color: #B0B0B0; }
        .bonus-checkbox input { width: auto; }
    </style>
</head>
<body>
    <div class="admin-container">
        <aside class="sidebar">
            <h2>Admin</h2>
            <nav>
                <ul>
                    <li><a href="#" id="nav-dashboard" class="active">Dashboard</a></li>
                    <li><a href="#" id="nav-users">Utilizadores</a></li>
                    <li><a href="#" id="nav-game-control">Controlo do Jogo</a></li>
                    <li><a href="/" style="color: #00BCD4; margin-top: 30px;">&larr; Voltar ao Site</a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <section id="dashboard-view" class="admin-view active">
                <h1>Dashboard</h1>
                <div class="stats-grid">
                    <div class="stat-card"><h3>Total de Utilizadores</h3><p id="stats-total-users">...</p></div>
                    <div class="stat-card"><h3>Saldo Total na Plataforma</h3><p id="stats-total-balance">R$ ...</p></div>
                    <div class="stat-card"><h3>Total de Comissões Pagas</h3><p id="stats-total-commissions">R$ ...</p></div>
                </div>
                <div class="chart-card">
                    <h2>Resumo Financeiro e de Atividade (Últimos 30 dias)</h2>
                    <div style="position: relative; height: 40vh; width: 100%;">
                        <canvas id="financial-chart"></canvas>
                    </div>
                </div>
            </section>

            <section id="users-view" class="admin-view">
                <h1>Gestão de Utilizadores</h1>
                <div style="overflow-x: auto;">
                    <table class="users-table">
                        <thead>
                            <tr>
                                <th>ID do Utilizador</th>
                                <th>Nome</th>
                                <th>Role</th>
                                <th>Saldo (R$)</th>
                                <th>Comissão (R$)</th>
                                <th>Data de Registo</th>
                            </tr>
                        </thead>
                        <tbody id="users-table-body"></tbody>
                    </table>
                </div>
            </section>

            <section id="game-control-view" class="admin-view">
                <h1>Controlo do Próximo Sorteio</h1>
                <p>Use os botões abaixo para definir o resultado da próxima ronda.</p>
                <div class="bet-area" style="justify-content: flex-start;">
                    <button class="bet-button" data-color="RED">Forçar Vermelho</button>
                    <button class="bet-button" data-color="BLUE">Forçar Azul</button>
                    <button class="bet-button" data-color="GREEN">Forçar Verde</button>
                </div>
                <p id="admin-status" style="margin-top: 25px; font-size: 1.1em;">A aguardar comando...</p>
            </section>
        </main>
    </div>

    <!-- MODAL DE EDIÇÃO ATUALIZADO COM OPÇÃO DE BÓNUS -->
    <div id="user-edit-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="modal-close-btn" class="modal-close">&times;</button>
            <h2 id="modal-title">Editar Utilizador</h2>
            <div id="modal-body">
                <div class="form-group">
                    <label for="modal-user-role">Role (Função)</label>
                    <select id="modal-user-role">
                        <option value="affiliate">Afiliado</option>
                        <option value="influencer">Influencer</option>
                        <option value="admin">Admin</option>
                    </select>
                    <button id="modal-save-role-btn" class="bet-button" style="background-color: #00BCD4; width: 100%; margin-top: 10px;">Salvar Role</button>
                </div>
                <hr style="border-color: #333; margin: 30px 0;">
                <div class="form-group">
                    <label>Saldos: 
                        <span id="modal-current-balance" style="color: white; font-weight: bold;"></span> (Real) + 
                        <span id="modal-current-bonus" style="color: #FFEB3B; font-weight: bold;"></span> (Bónus)
                    </label>
                    <input type="number" id="modal-transaction-amount" placeholder="Valor da transação">
                    <div class="bonus-checkbox">
                        <input type="checkbox" id="modal-add-bonus-checkbox">
                        <label for="modal-add-bonus-checkbox">Adicionar Bónus de 100% (Apenas Depósito)</label>
                    </div>
                    <div class="transaction-buttons">
                        <button id="modal-deposit-btn" class="bet-button" style="background-color: #4CAF50;">Registar Depósito</button>
                        <button id="modal-withdrawal-btn" class="bet-button" style="background-color: #E53935;">Registar Saque</button>
                    </div>
                </div>
                <p id="modal-status" style="text-align: center; margin-top: 15px;"></p>
            </div>
        </div>
    </div>

    <script type="module" src="/js/admin.js"></script>
</body>
</html>

